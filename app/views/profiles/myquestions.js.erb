
$("#feeds-section").remove();
$(".nav-section").append("<%= escape_javascript render partial: "question/feeds_section", locals: {questions: @questions} %>");

$(".reply").click(function (event){
    var pid = event.currentTarget.id.split("-")[1]
    var view_comments = event.currentTarget.getAttribute("view_comments")
    if (view_comments === "on"){
        if($(".loaded-comment"+pid).length === 0 ){
            $.ajax({
                "url": "/question/get_comments/" + pid,
                "method": "get",
                success: function (result) {
                    console.log(result)
                }
            });
        }
        $('#cmt'+pid).removeClass("hidden");
        event.currentTarget.setAttribute("view_comments", "off")
    }else if(view_comments === "off"){
        $("#cmt"+pid).addClass("hidden");
        event.currentTarget.setAttribute("view_comments", "on")
    }

});
function post_action(data){
    $.ajax({
        "url": "post_action",
        method: "post",
        data: {"user_id": data.user_id, "p_id": data.p_id, user_action: data.user_action},
        success: function (result){
        }
    });
}
$(".like").click(function (event){
    var elem_id = event.currentTarget.id;
    var pid = elem_id.split("-")[1];
    if (!$('#like-'+pid).hasClass("selected"))
        $("#like-count-"+pid).text(parseInt($("#like-count-"+pid).text())+parseInt(1));
    $('#like-'+pid).addClass("selected");
    if ($('#dislike-'+pid).hasClass("selected"))
        $("#dislike-count-"+pid).text(parseInt($("#dislike-count-"+pid).text())-1);
    $('#dislike-'+pid).removeClass("selected");
    post_action({user_id: <%= session[:user]["id"] %>, p_id: pid, user_action: "like"});
});
$(".dislike").click(function (event){
    var pid = event.currentTarget.id.split("-")[1];
    if (!$('#dislike-'+pid).hasClass("selected"))
        $("#dislike-count-"+pid).text(parseInt($("#dislike-count-"+pid).text())+parseInt(1));
    $('#dislike-'+pid).addClass("selected");

    if ($('#like-'+pid).hasClass("selected"))
        $("#like-count-"+pid).text(parseInt($("#like-count-"+pid).text())-1);
    $('#like-'+pid).removeClass("selected");

    post_action({user_id: <%= session[:user]["id"] %>, p_id: pid, user_action: "dislike"});

});
